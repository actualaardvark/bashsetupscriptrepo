#!/bin/bash

source values.conf

obtainadminpassword(){
    read -p "Enter Admin Password (You'll only need to do this once): " adminpassword
	echo "$adminpassword" > /volumes/"$usbdevicename"/password.txt
}
executeremotescript(){
    curl -s https://raw.githubusercontent.com/actualaardvark/bashsetupscriptrepo/main/Mac%20Guided%20Enrollment%20Script > /volumes/"$usbdevicename"/"Mac Guided Enrollment Script"
    chmod +x /volumes/"$usbdevicename"/"Mac Guided Enrollment Script"
    sh /volumes/"$usbdevicename"/"Mac Guided Enrollment Script"
}
checkpasswordpresence(){
    if [ ! -f  /volumes/"$usbdevicename"/password.txt ]; then
        obtainadminpassword
    else
    	executeremotescript
    	exit 1
    fi
}
checknetworkconnection(){
    if [[ $(ping -q -c1 $connectioncheckurl &>/dev/null && echo online || echo offline) == "offline" ]]; then
        echo "No Network Connection"
        exit 1
    fi
}
installappcheckscript(){
    mkdir /volumes/"$usbdevicename"/"Additional Scripts"
    curl -s https://raw.githubusercontent.com/actualaardvark/bashsetupscriptrepo/main/Additional%20Scripts/App%20Install%20Inspector > /volumes/"$usbdevicename"/"Additional Scripts"/"App Install Inspector"
    chmod +x /volumes/"$usbdevicename"/"Additional Scripts"/"App Install Inspector"
}
adminpassword=$(cat /volumes/"$usbdevicename"/password.txt)

if [ $connectioncheckenabled == "true" ]; then
    checknetworkconnection
fi

installappcheckscript

checkpasswordpresence

executeremotescript